<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
  padding-top: 0px;
}
</style>

</head>

<body>

<h1 id="data-preparation-for-global-covid-19-cases">Data Preparation for Global COVID-19 Cases</h1>
<p>Michael Harper</p>
<h1 id="about">About</h1>
<p>This document loads and preprocesses the data which is used for further analysis:</p>
<ul>
<li>Merges John Hopkins into single dataset</li>
<li>Resolves name differences with spatial dataset and other files</li>
<li>Enriches data by calculating additional metrics such as cases per million, rate of change</li>
</ul>
<!-- end list -->

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">echo =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(readr)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(sf)</span></code></pre></div>
<pre><code>## Linking to GEOS 3.8.1, GDAL 3.1.2, PROJ 7.1.0
</code></pre>
<h1 id="specify-global-naming">Specify Global Naming</h1>
<p>The analysis uses different datasets which slightly different naming conventions. For example, some datasets had <code>United States</code> while other had <code>US</code>. A dictionary of replacement names was therefore created which is later used to recode the data. The <code>recode</code> function is used throughout the example referring to the following list:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Resolves inconsistencies between naming in data sources</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co"># Not all datasets have inconsistences but set here and applied to all</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>countryNameDict &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Czech Republic&quot;</span> =<span class="st"> &quot;Czechia&quot;</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>                     <span class="st">&quot;United Kingdom&quot;</span> =<span class="st"> &quot;UK&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a>                     <span class="st">&quot;Bosnia Herzegovina&quot;</span> =<span class="st"> &quot;Bosnia and Herzegovina&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>                     <span class="st">&quot;Iran, Islamic Rep.&quot;</span> =<span class="st"> &quot;Iran&quot;</span>,</span>
<span id="cb3-7"><a href="#cb3-7"></a>                     <span class="st">&quot;Macedonia&quot;</span> =<span class="st"> &quot;North Macedonia&quot;</span>,</span>
<span id="cb3-8"><a href="#cb3-8"></a>                     <span class="st">&quot;United States&quot;</span> =<span class="st"> &quot;US&quot;</span>,</span>
<span id="cb3-9"><a href="#cb3-9"></a>                     <span class="st">&quot;Russian Federation&quot;</span> =<span class="st"> &quot;Russia&quot;</span>,</span>
<span id="cb3-10"><a href="#cb3-10"></a>                     <span class="st">&quot;Dem. Rep. Korea&quot;</span> =<span class="st"> &quot;North Korea&quot;</span>,</span>
<span id="cb3-11"><a href="#cb3-11"></a>                     <span class="st">&quot;Congo (Kinshasa)&quot;</span> =<span class="st"> &quot;DRC&quot;</span>,</span>
<span id="cb3-12"><a href="#cb3-12"></a>                     <span class="st">&quot;Democratic Republic of the Congo&quot;</span> =<span class="st"> &quot;DRC&quot;</span>,</span>
<span id="cb3-13"><a href="#cb3-13"></a>                     <span class="st">&quot;Congo (Brazzaville)&quot;</span> =<span class="st"> &quot;Congo&quot;</span>,</span>
<span id="cb3-14"><a href="#cb3-14"></a>                     <span class="st">&quot;Republic of the Congo&quot;</span> =<span class="st"> &quot;Congo&quot;</span>,</span>
<span id="cb3-15"><a href="#cb3-15"></a>                     <span class="st">&quot;Côte d&#39;Ivoire&quot;</span> =<span class="st"> &quot;Cote d&#39;Ivoire&quot;</span>,</span>
<span id="cb3-16"><a href="#cb3-16"></a>                     <span class="st">&quot;Bahamas, The&quot;</span> =<span class="st"> &quot;Bahamas&quot;</span>,</span>
<span id="cb3-17"><a href="#cb3-17"></a>                     <span class="st">&quot;Taiwan*&quot;</span> =<span class="st"> &quot;Taiwan&quot;</span>,</span>
<span id="cb3-18"><a href="#cb3-18"></a>                     <span class="st">&quot;Korea, South&quot;</span> =<span class="st"> &quot;South Korea&quot;</span>)</span></code></pre></div>
<h1 id="loading-john-hopkins-dataset">Loading John Hopkins Dataset</h1>
<!---
# Potentially could use this API in future?
# Note, does not provide province level data
# https://github.com/pomber/covid19
--->

<p>For the analysis, I am using the COVID-19 dataset produced by John Hopkins University. They provide a daily updating dataset at a national level, which provides the cases, recoveries and deaths associated with the virus. The data can be accessed through the GitHub <a href="https://github.com/CSSEGISandData/COVID-19">repository here</a>, and they also offer a great dashboard for visualising the data <a href="https://coronavirus.jhu.edu/map.html">here</a>.</p>
<p>There are three separate files for different records stored within the following directory:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Using the John hopkins dataset which updates daily</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>rootDir &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a>files &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;time_series_covid19_confirmed_global.csv&quot;</span>, <span class="st">&quot;time_series_covid19_deaths_global.csv&quot;</span>, <span class="st">&quot;time_series_covid19_recovered_global.csv&quot;</span>)</span></code></pre></div>
<p>When the data is loaded, some basic data cleaning to make the data usable for graphing. For those familiar with the tidyverse in R, most functions prefer to have data in <a href="http://www.cookbook-r.com/Manipulating_data/Converting_data_between_wide_and_long_format/">long format</a>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Function clean data for each of the files and aggregate</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>dataToLong &lt;-<span class="st"> </span><span class="cf">function</span>(filename, var){</span>
<span id="cb5-3"><a href="#cb5-3"></a>  </span>
<span id="cb5-4"><a href="#cb5-4"></a>  df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">file.path</span>(rootDir, filename), <span class="dt">col_types =</span> <span class="kw">cols</span>())</span>
<span id="cb5-5"><a href="#cb5-5"></a>  </span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="co"># Convert to long data</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  dataLong &lt;-<span class="st"> </span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="st">    </span>df <span class="op">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="st">    </span>tidyr<span class="op">::</span><span class="kw">gather</span>(<span class="dt">key =</span> <span class="st">&quot;date&quot;</span>, <span class="st">&quot;cases&quot;</span>, <span class="op">-</span><span class="kw">c</span>(<span class="st">&quot;Province/State&quot;</span>,  <span class="st">&quot;Country/Region&quot;</span>, <span class="st">&quot;Lat&quot;</span>, <span class="st">&quot;Long&quot;</span>))</span>
<span id="cb5-10"><a href="#cb5-10"></a>  </span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="co"># Aggregate to only have a single region per country</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>  df_all &lt;-</span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="st">    </span>dataLong <span class="op">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="st">    </span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="st">&quot;province&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;long&quot;</span>, <span class="st">&quot;date&quot;</span>, <span class="st">&quot;value&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="st">    </span><span class="kw">group_by</span>(region, date) <span class="op">%&gt;%</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">value =</span> <span class="kw">sum</span>(value)) <span class="op">%&gt;%</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date =</span> lubridate<span class="op">::</span><span class="kw">parse_date_time</span>(date, <span class="st">&quot;%m%d%y&quot;</span>),</span>
<span id="cb5-19"><a href="#cb5-19"></a>           <span class="dt">region =</span> <span class="kw">recode</span>(region, <span class="op">!!!</span>countryNameDict), </span>
<span id="cb5-20"><a href="#cb5-20"></a>           <span class="dt">type =</span> var)</span>
<span id="cb5-21"><a href="#cb5-21"></a>  </span>
<span id="cb5-22"><a href="#cb5-22"></a>  <span class="kw">return</span>(df_all)</span>
<span id="cb5-23"><a href="#cb5-23"></a>} </span></code></pre></div>
<p>This function is run across all three input dataframes and then merged into a single dataframe:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Combine data</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>df_all &lt;-<span class="st"> </span><span class="kw">map2_df</span>(<span class="dt">.x =</span> files,</span>
<span id="cb6-3"><a href="#cb6-3"></a>                  <span class="dt">.y =</span> <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;deaths&quot;</span>, <span class="st">&quot;recovered&quot;</span>),</span>
<span id="cb6-4"><a href="#cb6-4"></a>                  <span class="dt">.f =</span> <span class="cf">function</span>(x,y) <span class="kw">dataToLong</span>(x,y))</span></code></pre></div>
<h1 id="calculate-additional-metrics">Calculate Additional Metrics</h1>
<p>Some additional metrics are calculated from the raw data:</p>
<ul>
<li><code>rate of change</code>: how many new cases have there been since the day before and 7 days previous estimates.</li>
<li><code>days Since outbreak</code> calculates how long it has been since the first reported case in a country</li>
</ul>
<!-- end list -->

<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># calculate when the first reported case was</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>firstOutbreak &lt;-<span class="st"> </span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span>df_all <span class="op">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;cases&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="st">  </span><span class="kw">filter</span>(value <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="st">  </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="st">  </span><span class="kw">filter</span>(date <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(date)) <span class="op">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">firstOutbreak =</span> date) <span class="op">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(date, value, type))</span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co"># do the same as above, but this time work out when they passed the 200th case</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>first200Outbreak &lt;-<span class="st"> </span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="st">  </span>df_all <span class="op">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;cases&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="st">  </span><span class="kw">filter</span>(value <span class="op">&gt;</span><span class="st"> </span><span class="dv">200</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="st">  </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="st">  </span><span class="kw">filter</span>(date <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(date)) <span class="op">%&gt;%</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first200Outbreak =</span> date) <span class="op">%&gt;%</span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(date, value, type))</span>
<span id="cb7-20"><a href="#cb7-20"></a></span>
<span id="cb7-21"><a href="#cb7-21"></a>firstDeath &lt;-<span class="st"> </span></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="st">  </span>df_all <span class="op">%&gt;%</span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;deaths&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="st">  </span><span class="kw">filter</span>(value <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="st">  </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="st">  </span><span class="kw">filter</span>(date <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(date)) <span class="op">%&gt;%</span></span>
<span id="cb7-27"><a href="#cb7-27"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">firstDeath =</span> date) <span class="op">%&gt;%</span></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(date, value, type))</span>
<span id="cb7-29"><a href="#cb7-29"></a></span>
<span id="cb7-30"><a href="#cb7-30"></a>first10Deaths &lt;-<span class="st"> </span></span>
<span id="cb7-31"><a href="#cb7-31"></a><span class="st">  </span>df_all <span class="op">%&gt;%</span></span>
<span id="cb7-32"><a href="#cb7-32"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;deaths&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-33"><a href="#cb7-33"></a><span class="st">  </span><span class="kw">filter</span>(value <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-34"><a href="#cb7-34"></a><span class="st">  </span><span class="kw">group_by</span>(region) <span class="op">%&gt;%</span></span>
<span id="cb7-35"><a href="#cb7-35"></a><span class="st">  </span><span class="kw">filter</span>(date <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(date)) <span class="op">%&gt;%</span></span>
<span id="cb7-36"><a href="#cb7-36"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first10Deaths =</span> date) <span class="op">%&gt;%</span></span>
<span id="cb7-37"><a href="#cb7-37"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(date, value, type))</span>
<span id="cb7-38"><a href="#cb7-38"></a></span>
<span id="cb7-39"><a href="#cb7-39"></a><span class="co"># Calculate additional metrics such as rate of contagion</span></span>
<span id="cb7-40"><a href="#cb7-40"></a>df_cases_extra &lt;-</span>
<span id="cb7-41"><a href="#cb7-41"></a><span class="st">  </span>df_all <span class="op">%&gt;%</span></span>
<span id="cb7-42"><a href="#cb7-42"></a><span class="st">  </span><span class="kw">left_join</span>(firstOutbreak) <span class="op">%&gt;%</span></span>
<span id="cb7-43"><a href="#cb7-43"></a><span class="st">  </span><span class="kw">left_join</span>(first200Outbreak) <span class="op">%&gt;%</span></span>
<span id="cb7-44"><a href="#cb7-44"></a><span class="st">  </span><span class="kw">left_join</span>(firstDeath) <span class="op">%&gt;%</span></span>
<span id="cb7-45"><a href="#cb7-45"></a><span class="st">  </span><span class="kw">left_join</span>(first10Deaths) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb7-46"><a href="#cb7-46"></a><span class="st">  </span><span class="kw">group_by</span>(region, type) <span class="op">%&gt;%</span></span>
<span id="cb7-47"><a href="#cb7-47"></a><span class="st">  </span><span class="kw">arrange</span>(region, type, date) <span class="op">%&gt;%</span></span>
<span id="cb7-48"><a href="#cb7-48"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">daysSinceOutbreak =</span> <span class="kw">as.numeric</span>(date <span class="op">-</span><span class="st"> </span>firstOutbreak)<span class="op">/</span><span class="dv">86400</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb7-49"><a href="#cb7-49"></a>         <span class="dt">daysSinceOutbreak =</span> <span class="kw">ifelse</span>(daysSinceOutbreak <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, <span class="ot">NA</span>, daysSinceOutbreak),</span>
<span id="cb7-50"><a href="#cb7-50"></a>         <span class="dt">daysSinceFirstDeath =</span> <span class="kw">as.numeric</span>(date <span class="op">-</span><span class="st"> </span>firstDeath)<span class="op">/</span><span class="dv">86400</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb7-51"><a href="#cb7-51"></a>         <span class="dt">daysSinceFirstDeath =</span> <span class="kw">ifelse</span>(daysSinceFirstDeath <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, <span class="ot">NA</span>, daysSinceFirstDeath),</span>
<span id="cb7-52"><a href="#cb7-52"></a>         <span class="dt">daysSince10Deaths =</span> <span class="kw">as.numeric</span>(date <span class="op">-</span><span class="st"> </span>first10Deaths)<span class="op">/</span><span class="dv">86400</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb7-53"><a href="#cb7-53"></a>         <span class="dt">daysSince10Deaths =</span> <span class="kw">ifelse</span>(daysSince10Deaths <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, <span class="ot">NA</span>, daysSince10Deaths),</span>
<span id="cb7-54"><a href="#cb7-54"></a>         <span class="dt">daysSince200Outbreak =</span> <span class="kw">as.numeric</span>(date <span class="op">-</span><span class="st"> </span>first200Outbreak)<span class="op">/</span><span class="dv">86400</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb7-55"><a href="#cb7-55"></a>         <span class="dt">daysSince200Outbreak =</span> <span class="kw">ifelse</span>(daysSince200Outbreak <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, <span class="ot">NA</span>, daysSince200Outbreak),</span>
<span id="cb7-56"><a href="#cb7-56"></a>         <span class="dt">changeDaily =</span> value <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(value, <span class="dt">n =</span> <span class="dv">1</span>),</span>
<span id="cb7-57"><a href="#cb7-57"></a>         <span class="dt">changeWeekly =</span> value <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(value, <span class="dt">n =</span> <span class="dv">7</span>),</span>
<span id="cb7-58"><a href="#cb7-58"></a>         <span class="dt">changeDailyPerc =</span> <span class="kw">round</span>(changeDaily<span class="op">/</span>value <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">0</span>),</span>
<span id="cb7-59"><a href="#cb7-59"></a>         <span class="dt">changeDailyPerc =</span> <span class="kw">ifelse</span>(<span class="kw">is.nan</span>(changeDailyPerc), <span class="ot">NA</span>, changeDailyPerc),</span>
<span id="cb7-60"><a href="#cb7-60"></a>         <span class="dt">changeWeeklyPerc =</span> <span class="kw">round</span>(changeWeekly<span class="op">/</span>value <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">0</span>),</span>
<span id="cb7-61"><a href="#cb7-61"></a>         <span class="dt">changeWeeklyPerc =</span> <span class="kw">ifelse</span>(<span class="kw">is.nan</span>(changeWeeklyPerc), <span class="ot">NA</span>, changeWeeklyPerc)) <span class="op">%&gt;%</span></span>
<span id="cb7-62"><a href="#cb7-62"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(firstOutbreak, first200Outbreak, firstDeath, first10Deaths))</span></code></pre></div>
<pre><code>## Joining, by = &quot;region&quot;
## Joining, by = &quot;region&quot;
## Joining, by = &quot;region&quot;
## Joining, by = &quot;region&quot;
</code></pre>
<h1 id="load-population-data">Load Population Data</h1>
<p>To calculate normalised infection rates, we will use the population dataset from the <a href="https://data.worldbank.org/indicator/SP.POP.TOTL">WorldBank</a>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># World bank population estimates</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>pop &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;dataIn/worldBankPop.csv&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3"></a>                <span class="dt">col_types =</span> <span class="kw">cols</span>()) <span class="op">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;Country Name&quot;</span>, <span class="st">&quot;2018&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="st">  </span><span class="kw">set_names</span>(<span class="st">&quot;region&quot;</span>, <span class="st">&quot;pop&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pop =</span> <span class="kw">round</span>(pop<span class="op">/</span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span>, <span class="dv">2</span>),</span>
<span id="cb9-7"><a href="#cb9-7"></a>         <span class="dt">region =</span> <span class="kw">recode</span>(region, <span class="op">!!!</span>countryNameDict))</span></code></pre></div>
<pre><code>## Warning: Missing column names filled in: &#39;X65&#39; [65]
</code></pre>
<p>This is merged with the full dataset and then used to calculate the infection rates:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Merge data with shapefile</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co"># Normalise rates</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>df_all_extra &lt;-<span class="st"> </span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span>df_cases_extra <span class="op">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">  </span><span class="kw">left_join</span>(pop) <span class="op">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">replace_na</span>(value, <span class="dv">0</span>),</span>
<span id="cb11-7"><a href="#cb11-7"></a>         <span class="dt">casespermillion =</span> <span class="kw">round</span>(value<span class="op">/</span>pop, <span class="dv">2</span>)) <span class="op">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="st">  </span><span class="kw">arrange</span>(region, date)</span></code></pre></div>
<pre><code>## Joining, by = &quot;region&quot;
</code></pre>
<h1 id="income-groups">Income Groups</h1>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>income_group &lt;-<span class="st"> </span><span class="kw">read_csv</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data/dataIn/WorldIncomeGroups.csv&quot;</span>), <span class="dt">col_types =</span> <span class="kw">cols</span>()) <span class="op">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">  </span><span class="kw">filter</span>(Year <span class="op">==</span><span class="st"> &quot;Fiscal Year 2020&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">&quot;Economy&quot;</span>, <span class="st">&quot;Income Group&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="st">  </span><span class="kw">set_names</span>(<span class="st">&quot;region&quot;</span>, <span class="st">&quot;Income&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">region =</span> <span class="kw">recode</span>(region, <span class="op">!!!</span>countryNameDict))</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a></span>
<span id="cb13-8"><a href="#cb13-8"></a>df_all_extra &lt;-<span class="st"> </span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="st">  </span>df_all_extra <span class="op">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="st">  </span><span class="kw">left_join</span>(income_group)</span></code></pre></div>
<pre><code>## Joining, by = &quot;region&quot;
</code></pre>
<h1 id="spatial-data">Spatial Data</h1>
<p>Spatial data is useful for visualising the datasets. These are formatted to be consistent with the second dataset, making renaming the fields to match and altering names to match to enable an easy spatial join:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Load global boundaries</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>world_map &lt;-<span class="st"> </span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="st">  </span>spData<span class="op">::</span>world <span class="op">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="st">  </span><span class="kw">st_as_sf</span>() <span class="op">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="st">  </span><span class="kw">select</span>(name_long, continent) <span class="op">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="st">  </span><span class="kw">rename</span>(<span class="st">&quot;region&quot;</span> =<span class="st"> &quot;name_long&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="st">  </span><span class="kw">filter</span>(region <span class="op">!=</span><span class="st"> &quot;Antarctica&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Not useful display antartica</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">region =</span> <span class="kw">recode</span>(region, <span class="op">!!!</span>countryNameDict))</span></code></pre></div>
<p>These can be merged into a single long data format. Note this format is not very efficient for storage as it duplicates the spatial data, but is required to make it easy to use within the <strong>tidyverse</strong> workflow:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># This is not saved as it takes up more space 70+ MBs</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>df_all_spatial &lt;-<span class="st"> </span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="st">  </span>df_all_extra <span class="op">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="st">  </span><span class="kw">left_join</span>(world_map)</span></code></pre></div>
<pre><code>## Joining, by = &quot;region&quot;
</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Retain the continent variable</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>df_all_extra &lt;-<span class="st"> </span></span>
<span id="cb18-3"><a href="#cb18-3"></a>df_all_spatial <span class="op">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="st">  </span><span class="kw">st_as_sf</span>() <span class="op">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="st">  </span>sf<span class="op">::</span><span class="kw">st_drop_geometry</span>()</span></code></pre></div>
<h1 id="save-data">Save Data</h1>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">write_csv</span>(df_all_extra, <span class="st">&quot;../data/global/covid_data_global.csv&quot;</span>, <span class="dt">append =</span> <span class="ot">FALSE</span>)</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>sf<span class="op">::</span><span class="kw">write_sf</span>(world_map, <span class="st">&quot;../data/global/covid_data_global_boundaries.geojson&quot;</span>, <span class="dt">delete_dsn =</span> T)</span></code></pre></div>
<p>f</p>
<h1 id="session-info">Session Info</h1>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.0.2 (2020-06-22)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Catalina 10.15.6
## 
## Matrix products: default
## BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] sf_0.9-5        rmarkdown_2.3   here_0.1        forcats_0.5.0   stringr_1.4.0   dplyr_1.0.2     purrr_0.3.4     readr_1.3.1     tidyr_1.1.2    
## [10] tibble_3.0.3    ggplot2_3.3.2   tidyverse_1.3.0
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.5         lattice_0.20-41    lubridate_1.7.9    class_7.3-17       assertthat_0.2.1   rprojroot_1.3-2    digest_0.6.25     
##  [8] packrat_0.5.0      R6_2.4.1           cellranger_1.1.0   backports_1.1.9    reprex_0.3.0       evaluate_0.14      e1071_1.7-3       
## [15] httr_1.4.2         pillar_1.4.6       rlang_0.4.7        curl_4.3           readxl_1.3.1       rstudioapi_0.11    raster_3.3-13     
## [22] blob_1.2.1         munsell_0.5.0      broom_0.7.0        compiler_4.0.2     modelr_0.1.8       xfun_0.16          pkgconfig_2.0.3   
## [29] htmltools_0.5.0    tidyselect_1.1.0   codetools_0.2-16   fansi_0.4.1        crayon_1.3.4       dbplyr_1.4.4       withr_2.2.0       
## [36] grid_4.0.2         spData_0.3.8       jsonlite_1.7.1     gtable_0.3.0       lifecycle_0.2.0    DBI_1.1.0          magrittr_1.5      
## [43] units_0.6-7        scales_1.1.1       KernSmooth_2.23-17 cli_2.0.2          stringi_1.4.6      fs_1.5.0           sp_1.4-2          
## [50] xml2_1.3.2         ellipsis_0.3.1     generics_0.0.2     vctrs_0.3.4        tools_4.0.2        glue_1.4.2         hms_0.5.3         
## [57] yaml_2.2.1         colorspace_1.4-1   classInt_0.4-3     rvest_0.3.6        knitr_1.29         haven_2.3.1
</code></pre>

</body>
</html>
